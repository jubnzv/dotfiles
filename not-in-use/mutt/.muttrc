# References:
# https://github.com/noctuid/dotfiles/blob/master/mail/.muttrc
# https://wiki.archlinux.org/index.php/mutt
# https://eax.me/mutt/

# {{{ Paths
set header_cache     = ~/.mutt/cache/headers
set message_cachedir = ~/.mutt/cache/bodies
set certificate_file = ~/.mutt/certificates
# specify what to use to open attachments
set mailcap_path     = ~/.mutt/mailcap
set tmpdir           = ~/.mutt/temp
# set signature        = ~/.mutt/sig
set folder = "~/.mail"
# }}}

# {{{ General Settings
set mbox_type = Maildir
set charset = "utf-8"
# minimum time between scans; don't check (using mbsync)
set mail_check = 0
# quit without confirmation
set quit
# bell on new mails
set beep_new
# Retain 7 lines of previous page when scrolling.
set pager_context=7
# status bar on top
set status_on_top
# fetch the set of subscribed folders from your server on connection
set imap_check_subscribed

# view html automatically
auto_view text/html
# }}}

# {{{ Sending Mail (msmtp)
# no -a.. will default to default set in rc (or fail if no default)
# can just change $from or from email manually in compose
# will use that email instead with below settings
set sendmail = 'msmtp'

# {{{ Composing
# use neovim as editor; start on line 9; enable spelling
set editor="nvim \"+set spell\" +/^$/ +9"
# allow editing of headers
set edit_headers

# contacts with abook
set query_command="abook --mutt-query '%s'"
macro index,pager a "<pipe-message>abook --add-email-quiet<return>" "Add this sender to Abook"
# tab completion for adresses
bind editor <Tab> complete-query
# }}}

set ssl_force_tls
# }}}

# {{{ Accounts
# Note: gpg2 setup is required
# https://wiki.archlinux.org/index.php/mutt#Multiple_accounts
source ~/.mutt/acc-gmail.muttrc

# Allow Mutt to open a new IMAP connection automatically.
unset imap_passive

# How often to check for new mail (time in seconds).
set mail_check = 120
# }}}

# {{{ Appearance
source ~/.mutt/gruvbox-dark-colors.muttrc

set sidebar_visible = yes

set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%>─%?p?( %p postponed )?───"

# Header options
ignore *
# Show only these headers
unignore from: to: cc: date: subject:
unhdr_order *
# In this order
hdr_order from: to: cc: date: subject:

set date_format = "%y-%m-%d"
# }}}

# {{{ Bindings
# Add vim-keys plugin from contrib.
# See: https://github.com/neomutt/neomutt/issues/56
# source vim-keys.rc

# {{{ Unset defaults
bind pager g noop
bind index g noop
bind pager t noop
bind pager <esc> noop
# }}}

# Pager Key Bindings {{{
bind pager gg top
bind pager G  bottom
bind pager e  previous-line
bind pager n  next-line
# bind pager <esc> exit
bind pager h exit
bind pager i next-undeleted
bind pager to half-up
bind pager tk half-down
bind index ty next-unread-mailbox
# hide and show quoted parts in message
bind pager tq toggle-quoted
# }}}

# Tagging {{{
bind generic x tag-entry
bind index x tag-thread
bind pager x tag-message
# }}}

# Index {{{
# Quit without saving changes
bind index Q exit
# toggle whether changes to the mailbox will be written on exit
# bind index % noop
# (un)archive all messages in thread
bind index D delete-thread
bind index U undelete-thread
# mark current thread as read
bind index tr read-thread
# toggle thread
bind index <space> collapse-thread
# Saner copy/move dialogs
macro index C "<copy-message>?<toggle-mailboxes>" "copy a message to a mailbox"
macro index M "<save-message>?<toggle-mailboxes>" "move a message to a mailbox"
# save changes to mailbox (i.e. deleted messages; unread/read messages); also tab
# bind index <tab> sync-mailbox
bind index ts sync-mailbox
# navigation
bind index gg first-entry
bind index G last-entry
# colemak
bind index,query,browser,attach n next-entry
bind index,query,browser,attach e previous-entry
bind index tn next-thread
bind index te previous-thread
# bind index N next-subthread
# bind index E previous-subthread
bind index \e noop
# previously display headers
bind index h display-toggle-weed
bind index i display-message

# limiting (default l)
macro index L "<limit>all\n" "show all messages (undo limit)"
# tag by pattern
bind index tl tag-pattern
# option to sort by date, from, etc.
bind index X sort-mailbox
# }}}

# Sidebar Navigation {{{
bind index,pager tn   sidebar-next
bind index,pager <space> sidebar-next
bind index,pager tp     sidebar-prev
bind index,pager ti  sidebar-open
# }}}

# }}}

# vim:fdm=marker:fen:sw=2:tw=120
