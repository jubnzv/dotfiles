#!/usr/bin/env bash
#
# Send desktop notification with recent active taskwarrior task.
#
if [[ ! -x "$(command -v notify-send)" ]]; then
    echo "notify-send: command not found"
    exit 1
fi
if [[ ! -x "$(command -v task)" ]]; then
    echo "task: command not found"
    exit 1
fi

task_body=`task minimal +ACTIVE 2>/dev/null | sed '4q;d' | awk -F' ' '{ $2=""};1'`

if [[ $task_body == "" ]]; then
    notify-send -i $(realpath ~/.icon/taskwarrior.png) \
        "taskwarrior" "No active tasks."
else
    task_id=`echo $task_body | awk '{ print $1 }'`
    task_desc=`echo $task_body | awk '{ $1=""; print }' | awk '{$1=$1};1'`

    context=`task rc.gc=off _get rc.context`
    if [[ $context != "" ]]; then
        context="($context)"
    fi

    notify-send -i $(realpath ~/.icon/taskwarrior.png) \
        "taskwarrior" "Active task: ${task_id} ${context}: ${task_desc}"
fi

